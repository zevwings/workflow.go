# æ¨¡å—æµ‹è¯•éœ€æ±‚åˆ†æ

> æœ¬æ–‡æ¡£åˆ†æå„ä¸ªæ¨¡å—çš„æµ‹è¯•éœ€æ±‚ã€ä¼˜å…ˆçº§å’Œæµ‹è¯•ç­–ç•¥ã€‚

---

## ğŸ“‹ ç›®å½•

- [æ¨¡å—æµ‹è¯•ä¼˜å…ˆçº§](#æ¨¡å—æµ‹è¯•ä¼˜å…ˆçº§)
- [å„æ¨¡å—è¯¦ç»†åˆ†æ](#å„æ¨¡å—è¯¦ç»†åˆ†æ)
- [æµ‹è¯•è¦†ç›–ç‡æ£€æµ‹](#æµ‹è¯•è¦†ç›–ç‡æ£€æµ‹)
- [æµ‹è¯•å·¥å…·éœ€æ±‚](#æµ‹è¯•å·¥å…·éœ€æ±‚)
- [æµ‹è¯•ç¯å¢ƒéš”ç¦»ç­–ç•¥](#æµ‹è¯•ç¯å¢ƒéš”ç¦»ç­–ç•¥)
- [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)

---

## æ¨¡å—æµ‹è¯•ä¼˜å…ˆçº§

### ä¼˜å…ˆçº§åˆ†ç±»

| ä¼˜å…ˆçº§ | æ¨¡å— | åŸå›  |
|--------|------|------|
| **P0 - æœ€é«˜** | `internal/http` | åŸºç¡€è®¾æ–½ï¼Œæ‰€æœ‰æ¨¡å—ä¾èµ– |
| **P0 - æœ€é«˜** | `internal/config` | é…ç½®ç®¡ç†ï¼Œæ ¸å¿ƒåŠŸèƒ½ |
| **P1 - é«˜** | `internal/git` | Git æ“ä½œï¼Œæ ¸å¿ƒåŠŸèƒ½ |
| **P1 - é«˜** | `internal/llm` | LLM é›†æˆï¼Œå…³é”®ä¸šåŠ¡é€»è¾‘ |
| **P1 - é«˜** | `internal/jira` | Jira é›†æˆï¼Œå…³é”®ä¸šåŠ¡é€»è¾‘ |
| **P2 - ä¸­** | `internal/pr` | PR å¹³å°æŠ½è±¡ï¼Œéœ€è¦ Mock |
| **P2 - ä¸­** | `internal/prompt` | äº¤äº’å¼æç¤ºï¼Œæµ‹è¯•å¤æ‚ |
| **P3 - ä½** | `internal/logging` | æ—¥å¿—åŒ…è£…ï¼Œç®€å•åŠŸèƒ½ |

### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

æ ¹æ®æ¨¡å—ä¼˜å…ˆçº§è®¾ç½®ä¸åŒçš„è¦†ç›–ç‡ç›®æ ‡ï¼š

- **P0 æ¨¡å—**ï¼š> 90%ï¼ˆå…³é”®ä¸šåŠ¡é€»è¾‘ï¼‰
- **P1 æ¨¡å—**ï¼š> 85%ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
- **P2 æ¨¡å—**ï¼š> 75%ï¼ˆä¸€èˆ¬åŠŸèƒ½ï¼‰
- **P3 æ¨¡å—**ï¼š> 70%ï¼ˆå·¥å…·å‡½æ•°ï¼‰

---

## å„æ¨¡å—è¯¦ç»†åˆ†æ

### 1. internal/http

**æ¨¡å—èŒè´£**ï¼šHTTP å®¢æˆ·ç«¯å°è£…ï¼Œæä¾›ç»Ÿä¸€çš„ HTTP è¯·æ±‚æ¥å£ã€‚

**æµ‹è¯•éœ€æ±‚**ï¼š
- âœ… HTTP æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEã€PATCHï¼‰
- âœ… è¯·æ±‚é…ç½®ï¼ˆHeadersã€Bodyã€Queryã€Timeoutï¼‰
- âœ… é‡è¯•æœºåˆ¶ï¼ˆé‡è¯•æ¡ä»¶ã€é‡è¯•å»¶è¿Ÿã€æŒ‡æ•°é€€é¿ï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼ˆç½‘ç»œé”™è¯¯ã€HTTP é”™è¯¯ï¼‰
- âœ… è®¤è¯ï¼ˆTokenã€Basic Authï¼‰
- âœ… ä»£ç†é…ç½®
- âœ… Multipart è¯·æ±‚
- âœ… æµå¼è¯·æ±‚

**æµ‹è¯•ç­–ç•¥**ï¼š
- ä½¿ç”¨ `net/http/httptest` åˆ›å»º Mock HTTP æœåŠ¡å™¨
- æµ‹è¯•å„ç§ HTTP çŠ¶æ€ç ï¼ˆ200ã€400ã€500ã€429ï¼‰
- æµ‹è¯•ç½‘ç»œé”™è¯¯ï¼ˆtimeoutã€connection refusedï¼‰
- æµ‹è¯•é‡è¯•é€»è¾‘ï¼ˆé‡è¯•æ¬¡æ•°ã€å»¶è¿Ÿï¼‰

**æµ‹è¯•éš¾åº¦**ï¼šâ­â­ï¼ˆä½-ä¸­ï¼‰

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š30-40 ä¸ª

---

### 2. internal/config

**æ¨¡å—èŒè´£**ï¼šé…ç½®ç®¡ç†ï¼ŒåŒ…æ‹¬å…¨å±€é…ç½®å’Œä»“åº“é…ç½®ã€‚

**æµ‹è¯•éœ€æ±‚**ï¼š
- âœ… é…ç½®æ–‡ä»¶è¯»å–ï¼ˆTOML æ ¼å¼ï¼‰
- âœ… é…ç½®åˆå¹¶ï¼ˆå…¬å…±é…ç½® + ç§æœ‰é…ç½®ï¼‰
- âœ… ä»“åº“ ID ç”Ÿæˆï¼ˆåŸºäº Git remote URLï¼‰
- âœ… é…ç½®ä¿å­˜
- âœ… é»˜è®¤å€¼å¤„ç†
- âœ… é”™è¯¯å¤„ç†ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ã€æ ¼å¼é”™è¯¯ï¼‰

**æµ‹è¯•ç­–ç•¥**ï¼š
- ä½¿ç”¨ `t.TempDir()` åˆ›å»ºä¸´æ—¶é…ç½®æ–‡ä»¶
- ä½¿ç”¨ `t.Setenv()` éš”ç¦»ç¯å¢ƒå˜é‡
- Mock Git ä»“åº“æ¥å£ï¼ˆ`GitRepository`ï¼‰
- æµ‹è¯•é…ç½®æ–‡ä»¶çš„è¯»å–ã€åˆå¹¶ã€ä¿å­˜

**æµ‹è¯•éš¾åº¦**ï¼šâ­â­â­ï¼ˆä¸­ï¼‰

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š25-35 ä¸ª

---

### 3. internal/git

**æ¨¡å—èŒè´£**ï¼šGit æ“ä½œå°è£…ï¼Œæä¾›åˆ†æ”¯ã€æäº¤ã€è¿œç¨‹ç­‰æ“ä½œã€‚

**æµ‹è¯•éœ€æ±‚**ï¼š
- âœ… åˆ†æ”¯æ“ä½œï¼ˆåˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤ã€åˆ—è¡¨ï¼‰
- âœ… æäº¤æ“ä½œï¼ˆåˆ›å»ºã€æŸ¥è¯¢ï¼‰
- âœ… è¿œç¨‹æ“ä½œï¼ˆè·å– remote URLï¼‰
- âœ… æ ‡ç­¾æ“ä½œï¼ˆåˆ›å»ºã€åˆ—è¡¨ï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼ˆé Git ä»“åº“ã€åˆ†æ”¯ä¸å­˜åœ¨ï¼‰

**æµ‹è¯•ç­–ç•¥**ï¼š
- ä½¿ç”¨ `t.TempDir()` åˆ›å»ºä¸´æ—¶ç›®å½•
- ä½¿ç”¨ `go-git` åœ¨ä¸´æ—¶ç›®å½•ä¸­åˆå§‹åŒ– Git ä»“åº“
- æµ‹è¯•å„ç§ Git æ“ä½œåœºæ™¯
- æµ‹è¯•é”™è¯¯æƒ…å†µï¼ˆé Git ä»“åº“ã€åˆ†æ”¯ä¸å­˜åœ¨ï¼‰

**æµ‹è¯•éš¾åº¦**ï¼šâ­â­â­ï¼ˆä¸­ï¼‰

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š40-50 ä¸ª

---

### 4. internal/llm

**æ¨¡å—èŒè´£**ï¼šLLM å®¢æˆ·ç«¯ï¼Œæä¾›ç»Ÿä¸€çš„ LLM API æ¥å£ã€‚

**æµ‹è¯•éœ€æ±‚**ï¼š
- âœ… LLM å®¢æˆ·ç«¯åˆ›å»ºå’Œé…ç½®
- âœ… PR å†…å®¹ç”Ÿæˆ
- âœ… PR æ€»ç»“
- âœ… PR é‡å†™
- âœ… ç¿»è¯‘åŠŸèƒ½
- âœ… JSON è§£æå’Œä¿®å¤ï¼ˆ`ExtractJSONFromMarkdown`ã€`FixJSONEscapes`ï¼‰
- âœ… Diff æˆªæ–­ï¼ˆ`TruncateDiff`ï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼ˆAPI é”™è¯¯ã€ç½‘ç»œé”™è¯¯ï¼‰

**æµ‹è¯•ç­–ç•¥**ï¼š
- Mock HTTP å®¢æˆ·ç«¯ï¼ˆä½¿ç”¨ `httptest`ï¼‰
- æµ‹è¯•å„ç§ LLM å“åº”æ ¼å¼
- æµ‹è¯• JSON è§£æå’Œä¿®å¤é€»è¾‘
- æµ‹è¯•é”™è¯¯å¤„ç†å’Œé‡è¯•

**æµ‹è¯•éš¾åº¦**ï¼šâ­â­â­â­ï¼ˆä¸­-é«˜ï¼‰

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š35-45 ä¸ª

---

### 5. internal/jira

**æ¨¡å—èŒè´£**ï¼šJira REST API å®¢æˆ·ç«¯å°è£…ã€‚

**æµ‹è¯•éœ€æ±‚**ï¼š
- âœ… Jira å®¢æˆ·ç«¯åˆ›å»ºå’Œè®¤è¯
- âœ… Issue æ“ä½œï¼ˆè·å–ã€æ›´æ–°ã€çŠ¶æ€è½¬æ¢ï¼‰
- âœ… é™„ä»¶æ“ä½œï¼ˆè·å–ã€ä¸Šä¼ ï¼‰
- âœ… è¯„è®ºæ“ä½œï¼ˆæ·»åŠ ã€è·å–ï¼‰
- âœ… é¡¹ç›®æ“ä½œï¼ˆè·å–é¡¹ç›®ã€çŠ¶æ€åˆ—è¡¨ï¼‰
- âœ… ç”¨æˆ·æ“ä½œï¼ˆæœç´¢ç”¨æˆ·ã€è·å–å½“å‰ç”¨æˆ·ï¼‰
- âœ… Ticket Key éªŒè¯å’Œè§„èŒƒåŒ–
- âœ… é”™è¯¯å¤„ç†ï¼ˆAPI é”™è¯¯ã€è®¤è¯å¤±è´¥ï¼‰

**æµ‹è¯•ç­–ç•¥**ï¼š
- Mock Jira APIï¼ˆä½¿ç”¨ `httptest`ï¼‰
- æµ‹è¯•å„ç§ Jira API å“åº”
- æµ‹è¯• Ticket Key éªŒè¯å’Œè§„èŒƒåŒ–
- æµ‹è¯•é”™è¯¯å¤„ç†

**æµ‹è¯•éš¾åº¦**ï¼šâ­â­â­â­ï¼ˆä¸­-é«˜ï¼‰

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š30-40 ä¸ª

---

### 6. internal/pr

**æ¨¡å—èŒè´£**ï¼šPR å¹³å°æŠ½è±¡å±‚ï¼Œå®šä¹‰ç»Ÿä¸€çš„ PR æ“ä½œæ¥å£ã€‚

**æµ‹è¯•éœ€æ±‚**ï¼š
- âœ… æ¥å£å®šä¹‰éªŒè¯ï¼ˆç¡®ä¿æ‰€æœ‰æ–¹æ³•éƒ½æœ‰å®ç°ï¼‰
- âœ… GitHub å¹³å°å®ç°æµ‹è¯•ï¼ˆåœ¨ `internal/pr/github` ä¸­ï¼‰
- âœ… PR æ“ä½œï¼ˆåˆ›å»ºã€åˆå¹¶ã€å…³é—­ã€æ›´æ–°ï¼‰
- âœ… PR çŠ¶æ€æŸ¥è¯¢
- âœ… PR åˆ—è¡¨æŸ¥è¯¢
- âœ… è¯„è®ºæ“ä½œ
- âœ… é”™è¯¯å¤„ç†

**æµ‹è¯•ç­–ç•¥**ï¼š
- æµ‹è¯•æ¥å£å®ç°ï¼ˆç¡®ä¿æ‰€æœ‰æ–¹æ³•éƒ½æœ‰å®ç°ï¼‰
- Mock GitHub APIï¼ˆä½¿ç”¨ `httptest`ï¼‰
- æµ‹è¯•å„ç§ PR æ“ä½œåœºæ™¯
- æµ‹è¯•é”™è¯¯å¤„ç†

**æµ‹è¯•éš¾åº¦**ï¼šâ­â­â­ï¼ˆä¸­ï¼‰

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š20-30 ä¸ª

---

### 7. internal/prompt

**æ¨¡å—èŒè´£**ï¼šäº¤äº’å¼æç¤ºæ¨¡å—ï¼Œæä¾›è¾“å…¥ã€é€‰æ‹©ã€ç¡®è®¤ç­‰åŠŸèƒ½ã€‚

**æµ‹è¯•éœ€æ±‚**ï¼š
- âœ… è¾“å…¥åŠŸèƒ½ï¼ˆæ™®é€šè¾“å…¥ã€å¯†ç è¾“å…¥ã€å ä½ç¬¦ï¼‰
- âœ… éªŒè¯å™¨ï¼ˆé‚®ç®±ã€URLã€é•¿åº¦ã€æ­£åˆ™ï¼‰
- âœ… é€‰æ‹©åŠŸèƒ½ï¼ˆå•é€‰ã€å¤šé€‰ï¼‰
- âœ… ç¡®è®¤åŠŸèƒ½
- âœ… è¡¨æ ¼æ˜¾ç¤º
- âœ… ä¸»é¢˜é…ç½®
- âœ… ANSI è½¬ä¹‰åºåˆ—å¤„ç†

**æµ‹è¯•ç­–ç•¥**ï¼š
- ä½¿ç”¨ `os.Pipe()` æ¨¡æ‹Ÿç»ˆç«¯è¾“å…¥
- ä½¿ç”¨ `bytes.Buffer` æ•è·è¾“å‡º
- æµ‹è¯•å„ç§è¾“å…¥åœºæ™¯ï¼ˆæ­£å¸¸è¾“å…¥ã€é”™è¯¯è¾“å…¥ã€å–æ¶ˆï¼‰
- æµ‹è¯•éªŒè¯å™¨é€»è¾‘
- æµ‹è¯• ANSI è½¬ä¹‰åºåˆ—å¤„ç†

**æµ‹è¯•éš¾åº¦**ï¼šâ­â­â­â­â­ï¼ˆé«˜ï¼‰

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š50-60 ä¸ª

**æ³¨æ„**ï¼šç”±äºæ¶‰åŠç»ˆç«¯äº¤äº’ï¼Œéƒ¨åˆ†æµ‹è¯•å¯èƒ½éœ€è¦é›†æˆæµ‹è¯•æˆ–æ‰‹åŠ¨æµ‹è¯•ã€‚

---

### 8. internal/logging

**æ¨¡å—èŒè´£**ï¼šæ—¥å¿—æ¨¡å—ï¼Œæä¾›ç»Ÿä¸€çš„æ—¥å¿—æ¥å£ã€‚

**æµ‹è¯•éœ€æ±‚**ï¼š
- âœ… æ—¥å¿—çº§åˆ«è®¾ç½®
- âœ… æ—¥å¿—æ ¼å¼ï¼ˆTextã€JSONï¼‰
- âœ… æ—¥å¿—è¾“å‡ºï¼ˆæ ‡å‡†è¾“å‡ºã€æ–‡ä»¶ï¼‰
- âœ… æ—¥å¿—å‡½æ•°ï¼ˆDebugã€Infoã€Warnã€Errorã€Fatalï¼‰
- âœ… å­—æ®µæ·»åŠ ï¼ˆWithFieldã€WithFieldsã€WithErrorï¼‰

**æµ‹è¯•ç­–ç•¥**ï¼š
- ä½¿ç”¨ `bytes.Buffer` æ•è·æ—¥å¿—è¾“å‡º
- æµ‹è¯•å„ç§æ—¥å¿—çº§åˆ«å’Œæ ¼å¼
- æµ‹è¯•æ—¥å¿—å‡½æ•°è°ƒç”¨

**æµ‹è¯•éš¾åº¦**ï¼šâ­ï¼ˆä½ï¼‰

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š15-20 ä¸ª

---

## æµ‹è¯•è¦†ç›–ç‡æ£€æµ‹

### 1. åŸºæœ¬è¦†ç›–ç‡æ£€æµ‹

ä½¿ç”¨ Go æ ‡å‡†åº“çš„è¦†ç›–ç‡å·¥å…·ï¼š

```bash
# æ˜¾ç¤ºè¦†ç›–ç‡
go test -cover ./...

# æ˜¾ç¤ºæ¯ä¸ªåŒ…çš„è¦†ç›–ç‡
go test -cover ./internal/http
go test -cover ./internal/config
# ...

# ç”Ÿæˆè¦†ç›–ç‡æ–‡ä»¶
go test -coverprofile=coverage.out ./...

# æŸ¥çœ‹è¦†ç›–ç‡ç»Ÿè®¡
go tool cover -func=coverage.out

# ç”Ÿæˆ HTML æŠ¥å‘Š
go tool cover -html=coverage.out -o coverage.html
```

### 2. ä½¿ç”¨ Makefile

é¡¹ç›®å·²æä¾› `test-coverage` ç›®æ ‡ï¼š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make test-coverage

# æŸ¥çœ‹æŠ¥å‘Š
open coverage.html  # macOS
xdg-open coverage.html  # Linux
start coverage.html  # Windows
```

### 3. è¦†ç›–ç‡åˆ†æ

```bash
# æŸ¥çœ‹æ€»ä½“è¦†ç›–ç‡
go test -cover ./... | grep coverage

# æŸ¥çœ‹æœªè¦†ç›–çš„å‡½æ•°
go tool cover -func=coverage.out | grep -v "100.0%"

# æŸ¥çœ‹æœªè¦†ç›–çš„ä»£ç è¡Œï¼ˆåœ¨ HTML æŠ¥å‘Šä¸­æŸ¥çœ‹ï¼‰
go tool cover -html=coverage.out
```

### 4. CI/CD é›†æˆ

åœ¨ CI/CD ä¸­æ£€æµ‹è¦†ç›–ç‡ï¼š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æ–‡ä»¶ï¼ˆCI ç¯å¢ƒï¼‰
go test -coverprofile=coverage.out -covermode=atomic ./...

# ä¸Šä¼ åˆ°è¦†ç›–ç‡æœåŠ¡ï¼ˆå¦‚ Codecovï¼‰
# codecov -f coverage.out
```

### 5. è¦†ç›–ç‡ç›®æ ‡æ£€æŸ¥

åˆ›å»ºè„šæœ¬æ£€æŸ¥è¦†ç›–ç‡æ˜¯å¦è¾¾åˆ°ç›®æ ‡ï¼š

```bash
#!/bin/bash
# scripts/check-coverage.sh

# P0 æ¨¡å—ï¼š> 90%
P0_MODULES=("internal/http" "internal/config")
P0_THRESHOLD=90

# P1 æ¨¡å—ï¼š> 85%
P1_MODULES=("internal/git" "internal/llm" "internal/jira")
P1_THRESHOLD=85

# P2 æ¨¡å—ï¼š> 75%
P2_MODULES=("internal/pr" "internal/prompt")
P2_THRESHOLD=75

# P3 æ¨¡å—ï¼š> 70%
P3_MODULES=("internal/logging")
P3_THRESHOLD=70

check_coverage() {
    local module=$1
    local threshold=$2

    coverage=$(go test -cover "./$module" 2>/dev/null | grep coverage | awk '{print $5}' | sed 's/of//' | awk '{print $1}' | sed 's/%//')

    if (( $(echo "$coverage < $threshold" | bc -l) )); then
        echo "âŒ $module: ${coverage}% < ${threshold}%"
        return 1
    else
        echo "âœ… $module: ${coverage}% >= ${threshold}%"
        return 0
    fi
}

# æ£€æŸ¥å„æ¨¡å—è¦†ç›–ç‡
failed=0

for module in "${P0_MODULES[@]}"; do
    check_coverage "$module" "$P0_THRESHOLD" || failed=1
done

for module in "${P1_MODULES[@]}"; do
    check_coverage "$module" "$P1_THRESHOLD" || failed=1
done

for module in "${P2_MODULES[@]}"; do
    check_coverage "$module" "$P2_THRESHOLD" || failed=1
done

for module in "${P3_MODULES[@]}"; do
    check_coverage "$module" "$P3_THRESHOLD" || failed=1
done

exit $failed
```

---

## æµ‹è¯•å·¥å…·éœ€æ±‚

### 1. æ ¸å¿ƒæµ‹è¯•å·¥å…·ï¼ˆå·²åŒ…å«ï¼‰

- **Go æ ‡å‡†åº“**ï¼š
  - `testing` - æµ‹è¯•æ¡†æ¶
  - `net/http/httptest` - HTTP æµ‹è¯•
  - `os` - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
  - `io` - I/O æ“ä½œ

### 2. æ¨èæµ‹è¯•å·¥å…·ï¼ˆéœ€è¦å®‰è£…ï¼‰

#### testify

```bash
go get github.com/stretchr/testify
```

**ç”¨é€”**ï¼š
- æ–­è¨€ï¼ˆ`assert`ã€`require`ï¼‰
- Mock å¯¹è±¡ï¼ˆ`mock`ï¼‰
- æµ‹è¯•å¥—ä»¶ï¼ˆ`suite`ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```go
import (
    "testing"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/require"
)

func TestExample(t *testing.T) {
    result := ProcessData("input")
    assert.Equal(t, "expected", result)
    require.NoError(t, err)
}
```

#### go-cmpï¼ˆå¯é€‰ï¼‰

```bash
go get github.com/google/go-cmp/cmp
```

**ç”¨é€”**ï¼š
- æ·±åº¦æ¯”è¾ƒå¤æ‚æ•°æ®ç»“æ„
- æ¸…æ™°çš„å·®å¼‚è¾“å‡º

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```go
import (
    "testing"
    "github.com/google/go-cmp/cmp"
)

func TestConfigEqual(t *testing.T) {
    want := &Config{Host: "localhost", Port: 8080}
    got := &Config{Host: "localhost", Port: 8080}

    if diff := cmp.Diff(want, got); diff != "" {
        t.Errorf("Config mismatch (-want +got):\n%s", diff)
    }
}
```

### 3. æµ‹è¯•è¾…åŠ©å·¥å…·

é¡¹ç›®å¯èƒ½éœ€è¦åˆ›å»ºæµ‹è¯•è¾…åŠ©å·¥å…·ï¼ˆ`testutils` åŒ…ï¼‰ï¼š

```go
// internal/testutils/helpers.go
package testutils

import (
    "os"
    "path/filepath"
    "testing"
)

// TestHomeDir è·å–æµ‹è¯•ä¸»ç›®å½•
func TestHomeDir(t *testing.T) string {
    tempDir := t.TempDir()
    t.Setenv("HOME", tempDir)
    return tempDir
}

// TestConfigDir è·å–æµ‹è¯•é…ç½®ç›®å½•
func TestConfigDir(t *testing.T) string {
    homeDir := TestHomeDir(t)
    configDir := filepath.Join(homeDir, ".workflow", "config")
    os.MkdirAll(configDir, 0755)
    return configDir
}

// LoadFixture åŠ è½½æµ‹è¯•æ•°æ®
func LoadFixture(t *testing.T, filename string) []byte {
    path := filepath.Join("testdata", "fixtures", filename)
    data, err := os.ReadFile(path)
    require.NoError(t, err)
    return data
}
```

---

## æµ‹è¯•ç¯å¢ƒéš”ç¦»ç­–ç•¥

### 1. æ–‡ä»¶ç³»ç»Ÿéš”ç¦»

ä½¿ç”¨ `t.TempDir()` åˆ›å»ºä¸´æ—¶ç›®å½•ï¼š

```go
func TestConfigLoad(t *testing.T) {
    // åˆ›å»ºä¸´æ—¶ç›®å½•ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
    tempDir := t.TempDir()

    // åˆ›å»ºé…ç½®æ–‡ä»¶
    configPath := filepath.Join(tempDir, "config.toml")
    os.WriteFile(configPath, []byte("[test]\nkey = \"value\""), 0644)

    // æµ‹è¯•ä»£ç 
    // ...

    // æµ‹è¯•ç»“æŸåï¼ŒtempDir ä¼šè‡ªåŠ¨æ¸…ç†
}
```

### 2. ç¯å¢ƒå˜é‡éš”ç¦»

ä½¿ç”¨ `t.Setenv()` è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```go
func TestConfigWithEnv(t *testing.T) {
    // è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆè‡ªåŠ¨æ¢å¤ï¼‰
    t.Setenv("HOME", "/test/home")
    t.Setenv("CONFIG_DIR", "/test/config")

    // æµ‹è¯•ä»£ç 
    // ...

    // æµ‹è¯•ç»“æŸåï¼Œç¯å¢ƒå˜é‡ä¼šè‡ªåŠ¨æ¢å¤
}
```

### 3. Git ä»“åº“éš”ç¦»

åœ¨ä¸´æ—¶ç›®å½•ä¸­åˆ›å»º Git ä»“åº“ï¼š

```go
import (
    "os/exec"
    "path/filepath"
    "testing"
    "github.com/go-git/go-git/v5"
)

func TestGitOperation(t *testing.T) {
    // åˆ›å»ºä¸´æ—¶ç›®å½•
    tempDir := t.TempDir()

    // åˆå§‹åŒ– Git ä»“åº“
    repo, err := git.PlainInit(tempDir, false)
    require.NoError(t, err)

    // é…ç½® Git ç”¨æˆ·
    exec.Command("git", "config", "user.name", "Test User").Run()
    exec.Command("git", "config", "user.email", "test@example.com").Run()

    // æµ‹è¯•ä»£ç 
    // ...
}
```

### 4. HTTP æœåŠ¡å™¨éš”ç¦»

ä½¿ç”¨ `httptest` åˆ›å»º Mock HTTP æœåŠ¡å™¨ï¼š

```go
import (
    "net/http"
    "net/http/httptest"
    "testing"
)

func TestHTTPClient(t *testing.T) {
    // åˆ›å»º Mock æœåŠ¡å™¨
    server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        w.WriteHeader(http.StatusOK)
        w.Write([]byte(`{"id": 123}`))
    }))
    defer server.Close()

    // ä½¿ç”¨ Mock æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•
    client := NewHTTPClient(server.URL)
    result, err := client.Get("/api/test")

    assert.NoError(t, err)
    assert.Equal(t, 123, result.ID)
}
```

### 5. æµ‹è¯•æ¸…ç†

ä½¿ç”¨ `t.Cleanup()` æ³¨å†Œæ¸…ç†å‡½æ•°ï¼š

```go
func TestWithCleanup(t *testing.T) {
    // åˆ›å»ºèµ„æº
    resource := setupResource(t)

    // æ³¨å†Œæ¸…ç†å‡½æ•°ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰
    t.Cleanup(func() {
        resource.Cleanup()
    })

    // æµ‹è¯•ä»£ç 
    // ...

    // æµ‹è¯•ç»“æŸåï¼Œæ¸…ç†å‡½æ•°ä¼šè‡ªåŠ¨æ‰§è¡Œ
}
```

### 6. å¹¶è¡Œæµ‹è¯•

ä½¿ç”¨ `t.Parallel()` æ ‡è®°å¯å¹¶è¡Œæµ‹è¯•ï¼š

```go
func TestParallel(t *testing.T) {
    t.Parallel() // æ ‡è®°ä¸ºå¯å¹¶è¡Œæµ‹è¯•

    // æµ‹è¯•ä»£ç ï¼ˆç¡®ä¿ä¸å…±äº«çŠ¶æ€ï¼‰
    // ...
}
```

**æ³¨æ„**ï¼šå¹¶è¡Œæµ‹è¯•å¿…é¡»ç¡®ä¿ï¼š
- æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„ä¸´æ—¶ç›®å½•
- ä¸å…±äº«å…¨å±€çŠ¶æ€
- ä¸ä¾èµ–æµ‹è¯•æ‰§è¡Œé¡ºåº

---

## å®æ–½è®¡åˆ’

### é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½ï¼ˆ1-2 å¤©ï¼‰

1. **å®‰è£…æµ‹è¯•å·¥å…·**
   ```bash
   go get github.com/stretchr/testify
   go get github.com/google/go-cmp/cmp
   ```

2. **åˆ›å»ºæµ‹è¯•è¾…åŠ©å·¥å…·**
   - åˆ›å»º `internal/testutils` åŒ…
   - å®ç°è·¯å¾„è·å–å‡½æ•°ï¼ˆ`TestHomeDir`ã€`TestConfigDir`ï¼‰
   - å®ç°æµ‹è¯•æ•°æ®åŠ è½½å‡½æ•°ï¼ˆ`LoadFixture`ï¼‰

3. **è®¾ç½®æµ‹è¯•ç¯å¢ƒ**
   - åˆ›å»º `testdata/` ç›®å½•
   - åˆ›å»ºæµ‹è¯•æ•°æ®æ–‡ä»¶ï¼ˆfixturesï¼‰

### é˜¶æ®µ 2ï¼šP0 æ¨¡å—æµ‹è¯•ï¼ˆ3-5 å¤©ï¼‰

1. **internal/http**ï¼ˆ2-3 å¤©ï¼‰
   - HTTP æ–¹æ³•æµ‹è¯•
   - é‡è¯•æœºåˆ¶æµ‹è¯•
   - é”™è¯¯å¤„ç†æµ‹è¯•

2. **internal/config**ï¼ˆ1-2 å¤©ï¼‰
   - é…ç½®æ–‡ä»¶è¯»å–æµ‹è¯•
   - é…ç½®åˆå¹¶æµ‹è¯•
   - ä»“åº“ ID ç”Ÿæˆæµ‹è¯•

### é˜¶æ®µ 3ï¼šP1 æ¨¡å—æµ‹è¯•ï¼ˆ5-7 å¤©ï¼‰

1. **internal/git**ï¼ˆ2-3 å¤©ï¼‰
   - åˆ†æ”¯æ“ä½œæµ‹è¯•
   - æäº¤æ“ä½œæµ‹è¯•
   - è¿œç¨‹æ“ä½œæµ‹è¯•

2. **internal/llm**ï¼ˆ2-3 å¤©ï¼‰
   - LLM å®¢æˆ·ç«¯æµ‹è¯•
   - PR åŠŸèƒ½æµ‹è¯•
   - JSON è§£ææµ‹è¯•

3. **internal/jira**ï¼ˆ1-2 å¤©ï¼‰
   - Jira å®¢æˆ·ç«¯æµ‹è¯•
   - API æ“ä½œæµ‹è¯•
   - é”™è¯¯å¤„ç†æµ‹è¯•

### é˜¶æ®µ 4ï¼šP2 æ¨¡å—æµ‹è¯•ï¼ˆ3-5 å¤©ï¼‰

1. **internal/pr**ï¼ˆ1-2 å¤©ï¼‰
   - æ¥å£å®ç°æµ‹è¯•
   - GitHub å¹³å°æµ‹è¯•

2. **internal/prompt**ï¼ˆ2-3 å¤©ï¼‰
   - è¾“å…¥åŠŸèƒ½æµ‹è¯•
   - éªŒè¯å™¨æµ‹è¯•
   - é€‰æ‹©åŠŸèƒ½æµ‹è¯•

### é˜¶æ®µ 5ï¼šP3 æ¨¡å—æµ‹è¯•ï¼ˆ1 å¤©ï¼‰

1. **internal/logging**ï¼ˆ1 å¤©ï¼‰
   - æ—¥å¿—çº§åˆ«æµ‹è¯•
   - æ—¥å¿—æ ¼å¼æµ‹è¯•
   - æ—¥å¿—è¾“å‡ºæµ‹è¯•

### é˜¶æ®µ 6ï¼šè¦†ç›–ç‡ä¼˜åŒ–ï¼ˆ2-3 å¤©ï¼‰

1. **ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š**
   ```bash
   make test-coverage
   ```

2. **åˆ†æè¦†ç›–ç‡**
   - è¯†åˆ«ä½è¦†ç›–ç‡åŒºåŸŸ
   - è¡¥å……è¾¹ç•Œæµ‹è¯•
   - è¡¥å……é”™è¯¯å¤„ç†æµ‹è¯•

3. **è¾¾åˆ°è¦†ç›–ç‡ç›®æ ‡**
   - P0 æ¨¡å—ï¼š> 90%
   - P1 æ¨¡å—ï¼š> 85%
   - P2 æ¨¡å—ï¼š> 75%
   - P3 æ¨¡å—ï¼š> 70%

### é˜¶æ®µ 7ï¼šCI/CD é›†æˆï¼ˆ1 å¤©ï¼‰

1. **æ·»åŠ è¦†ç›–ç‡æ£€æŸ¥**
   - åœ¨ CI/CD ä¸­è¿è¡Œæµ‹è¯•
   - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
   - ä¸Šä¼ åˆ°è¦†ç›–ç‡æœåŠ¡ï¼ˆå¯é€‰ï¼‰

2. **æ·»åŠ è¦†ç›–ç‡é˜ˆå€¼æ£€æŸ¥**
   - åˆ›å»ºè¦†ç›–ç‡æ£€æŸ¥è„šæœ¬
   - åœ¨ CI/CD ä¸­è¿è¡Œæ£€æŸ¥

---

## æ€»ç»“

### æµ‹è¯•ä¼˜å…ˆçº§

1. **P0ï¼ˆæœ€é«˜ï¼‰**ï¼š`internal/http`ã€`internal/config`
2. **P1ï¼ˆé«˜ï¼‰**ï¼š`internal/git`ã€`internal/llm`ã€`internal/jira`
3. **P2ï¼ˆä¸­ï¼‰**ï¼š`internal/pr`ã€`internal/prompt`
4. **P3ï¼ˆä½ï¼‰**ï¼š`internal/logging`

### æµ‹è¯•å·¥å…·

- **æ ¸å¿ƒå·¥å…·**ï¼šGo æ ‡å‡†åº“ï¼ˆ`testing`ã€`httptest`ï¼‰
- **æ¨èå·¥å…·**ï¼š`testify`ï¼ˆæ–­è¨€ã€Mockï¼‰ã€`go-cmp`ï¼ˆæ·±åº¦æ¯”è¾ƒï¼‰
- **è¾…åŠ©å·¥å…·**ï¼š`testutils` åŒ…ï¼ˆæµ‹è¯•è¾…åŠ©å‡½æ•°ï¼‰

### æµ‹è¯•ç¯å¢ƒéš”ç¦»

- **æ–‡ä»¶ç³»ç»Ÿ**ï¼š`t.TempDir()`
- **ç¯å¢ƒå˜é‡**ï¼š`t.Setenv()`
- **HTTP æœåŠ¡å™¨**ï¼š`httptest`
- **Git ä»“åº“**ï¼šä¸´æ—¶ç›®å½• + `go-git`
- **æ¸…ç†**ï¼š`t.Cleanup()`

### è¦†ç›–ç‡ç›®æ ‡

- **P0 æ¨¡å—**ï¼š> 90%
- **P1 æ¨¡å—**ï¼š> 85%
- **P2 æ¨¡å—**ï¼š> 75%
- **P3 æ¨¡å—**ï¼š> 70%

### é¢„è®¡å·¥ä½œé‡

- **æ€»æµ‹è¯•ç”¨ä¾‹æ•°**ï¼š200-300 ä¸ª
- **é¢„è®¡æ—¶é—´**ï¼š15-20 å¤©
- **æµ‹è¯•æ–‡ä»¶æ•°**ï¼š8 ä¸ªæ¨¡å— Ã— 1-2 ä¸ªæµ‹è¯•æ–‡ä»¶ = 10-15 ä¸ªæµ‹è¯•æ–‡ä»¶

---

**æœ€åæ›´æ–°**: 2025-01-28

