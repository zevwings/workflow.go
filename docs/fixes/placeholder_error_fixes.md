# Placeholder 和错误提示问题修复

## 修复的问题

### 问题1：多次输入错误后会出现很多空格

**原因**：
- `clearErrorLine()` 函数清除错误行后，光标位置不正确（在输入行的行首而非末尾）
- 多次清除错误行时，光标位置累积错误，导致多余空格
- 清除错误行后没有重新显示输入行，导致光标位置与显示内容不一致

**修复**：
- 使用 `errorLineExists` 标志跟踪错误行是否存在
- 只在错误行确实存在时才调用 `clearErrorLine()`
- **关键修复**：每次清除错误行后，重新显示输入行（promptText + 输入内容），确保光标在输入行的末尾
- 在以下场景中应用此修复：
  - 输入字符时清除错误行
  - 退格键时清除错误行
  - 回车验证失败时清除错误行

### 问题2：Placeholder 输入内容后，删除了很多内容

**原因**：
- 使用 `clearLine()` 清除整行，包括 promptText
- 重新显示时可能丢失部分内容

**修复**：
- 改进清除逻辑：使用 `\r` + `\033[K` 清除到行尾
- 重新显示 promptText，确保不丢失提示信息
- 优化 placeholder 的显示和清除逻辑

### 问题3：光标位置不正确

**原因**：
- 初始显示时，光标在 placeholder 后面
- 用户期望光标在 promptText 后（即 placeholder 的第一个字符位置）

**修复**：
- 显示 placeholder 后，将光标移动到 promptText 后
- 确保光标在正确位置（placeholder 的第一个字符位置）

---

## 修复后的行为

### Placeholder 显示

**初始状态**：
```
请输入用户名: 例如：admin
                ^
                光标位置（在 promptText 后，placeholder 的第一个字符位置）
```

**用户输入第一个字符**：
```
请输入用户名: a
                ^
                光标位置（placeholder 消失，显示实际输入）
```

**用户删除所有字符**：
```
请输入用户名: 例如：admin
                ^
                光标位置（重新显示 placeholder）
```

### 错误提示

**验证失败**：
```
请输入邮箱: invalid@
请输入有效的邮箱地址
^
光标位置（在输入行末尾）
```

**用户继续输入**：
```
请输入邮箱: invalid@x
^
光标位置（错误提示自动清除）
```

---

## 关键改进

1. **错误行跟踪**：使用 `errorLineExists` 标志，避免不必要的光标移动
2. **清除逻辑优化**：使用 `\r` + `\033[K` 而不是 `clearLine()`，更精确
3. **光标位置修复**（**核心修复**）：
   - 每次清除错误行后，重新显示输入行（promptText + 输入内容/placeholder）
   - 确保光标始终在正确位置（输入内容的末尾或 placeholder 的第一个字符位置）
   - 避免多次清除错误行时光标位置累积错误
4. **状态管理**：改进状态跟踪，避免状态不一致
5. **实时验证优化**：在实时验证时，先清除旧错误再显示新错误，避免错误行重复

---

## 测试建议

1. **测试 Placeholder**：
   - 输入第一个字符，placeholder 应该消失
   - 删除所有字符，placeholder 应该重新显示
   - 光标位置应该正确

2. **测试错误提示**：
   - 多次输入错误，不应该出现多余空格
   - 输入时错误提示应该自动清除
   - 光标位置应该正确

3. **测试组合场景**：
   - Placeholder + 错误提示
   - 多次错误 + 输入
   - 退格 + 错误提示

