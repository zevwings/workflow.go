# 代码审查规范

> 本文档定义了 Workflow CLI 项目的代码审查规范和最佳实践，所有贡献者都应遵循这些规范。

---

## 📋 目录

- [概述](#-概述)
- [审查清单](#-审查清单)
- [审查重点](#-审查重点)
- [相关文档](#-相关文档)

---

## 📋 概述

本文档定义了代码审查规范，包括审查清单和审查重点，确保代码质量和一致性。

### 核心原则

- **质量优先**：确保代码质量和一致性
- **全面检查**：检查功能、质量、错误处理、性能、安全性
- **文档同步**：确保相关文档已同步更新

### 使用场景

- 提交 PR 前自查
- 代码审查时参考
- 代码审查后修复

---

## 审查清单

提交 PR 前，确保：

- [ ] 代码已格式化（`go fmt ./...` 或 `make fmt`）
- [ ] 通过 golangci-lint 检查（`golangci-lint run` 或 `make lint`）
- [ ] 所有测试通过（`go test ./...` 或 `make test`）
- [ ] 添加了必要的文档注释
- [ ] 遵循了错误处理规范
- [ ] 提交信息符合规范
- [ ] 没有引入新的警告
- [ ] **文档更新检查**（如适用）：
  - [ ] 新增模块：已创建/更新对应的架构文档（`docs/architecture/`）
  - [ ] 重构模块：已同步更新架构文档
  - [ ] API 变更：已更新文档中的接口描述
  - [ ] 功能变更：已更新文档中的功能说明
  - [ ] 配置变更：已更新文档中的配置项说明
  - [ ] 命令变更：已更新 README.md 中的命令清单
  - [ ] 已更新 CHANGELOG.md（如适用）

---

## 审查重点

### 功能正确性

- 代码是否实现了预期功能
- 边界情况是否处理正确
- 错误情况是否处理正确

### 代码质量

- 是否遵循了代码风格和最佳实践
- 代码是否清晰、易读
- 是否有重复代码
- 是否有未使用的代码

### 错误处理

- 是否正确处理了错误情况
- 错误消息是否清晰、用户友好
- 是否使用了错误包装（`%w`）
- 是否区分了用户错误和系统错误

### 性能

- 是否有性能问题
- 是否有不必要的内存分配
- 是否有不必要的并发操作

### 安全性

- 是否有安全漏洞
- 敏感信息是否正确处理
- 输入验证是否充分

### 可维护性

- 代码是否易于理解和维护
- 是否有适当的注释
- 函数是否过长（建议不超过 50 行）
- 是否有适当的测试覆盖

### 文档完整性

- 相关文档是否已同步更新（架构文档、README、CHANGELOG）
- 公共 API 是否有文档注释
- 复杂逻辑是否有注释说明

---

## 🔍 故障排除

### 问题 1：审查清单不完整

**症状**：提交 PR 时遗漏某些检查项

**解决方案**：

1. 使用审查清单逐项检查
2. 运行自动化检查工具（`go fmt`、`golangci-lint`、`go test`）
3. 检查文档是否已同步更新

### 问题 2：文档未同步更新

**症状**：代码变更后未更新相关文档

**解决方案**：

1. 检查是否需要更新架构文档
2. 检查是否需要更新 README.md
3. 检查是否需要更新 CHANGELOG.md
4. 使用 [架构文档审查指南](./references/review-architecture-consistency.md) 验证文档一致性

### 问题 3：golangci-lint 警告过多

**症状**：运行 `golangci-lint run` 时出现大量警告

**解决方案**：

1. 逐个修复警告（优先修复高优先级警告）
2. 对于确实需要忽略的警告，使用 `//nolint:linter-name` 并添加注释说明原因
3. 定期运行 `golangci-lint run` 保持代码质量

---

## 📚 相关文档

### 开发规范

- [Git 工作流规范](./git-workflow.md) - Git 工作流规范
- [提交规范](./commit.md) - 提交规范
- [代码风格规范](./code-style.md) - 代码风格规范
- [错误处理规范](./error-handling.md) - 错误处理规范

### 检查工作流

- [提交前检查](./workflows/pre-commit.md) - 代码质量检查流程
- [深入检查指南](./workflows/review.md) - 综合深入检查流程
- [架构文档审查指南](./references/review-architecture-consistency.md) - 架构文档检查方法和流程

---

## ✅ 检查清单

使用本规范时，请确保：

- [ ] 代码已格式化（`go fmt ./...`）
- [ ] 通过 golangci-lint 检查（`golangci-lint run`）
- [ ] 所有测试通过（`go test ./...`）
- [ ] 添加了必要的文档注释
- [ ] 遵循了错误处理规范
- [ ] 提交信息符合规范
- [ ] 文档已同步更新

---

**最后更新**: 2025-01-27
