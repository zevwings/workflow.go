---
description: 文档生成、分类和存储规则。关于何时以及如何生成文档的强制性规则。
type: always
---

# 文档生成规则

---

## 🚫 文档生成规则（强制执行）

### 核心原则

**默认禁止生成文档**：除非用户使用明确的关键词请求，否则一律不生成 `.md` 文档文件。

### ⚡ 快速决策树（执行前必读）

**生成文档前的快速检查**（必须按顺序执行，任何一步失败都必须立即停止）：

1. **白名单检查**（必须通过）
   - ❓ 用户消息包含 "生成文档"、"创建文档"、"生成报告"、"创建报告"、"保存为文档"、"输出到文件" 等白名单关键词？
   - ❌ **否** → **立即停止**，改为聊天文本响应
   - ✅ **是** → 继续下一步

2. **黑名单检查**（必须通过）
   - ❓ 用户消息包含 "分析"、"总结"、"检查"、"诊断"、"排查"、"查看"、"审查" 等黑名单关键词？
   - ✅ **是** → **立即停止**，改为聊天文本响应（🚨 **这些词是黑名单，禁止生成文档！**）
   - ❌ **否** → 继续下一步

3. **例外规则检查**
   - ❓ 是 Review/Pre-commit 工作流自动报告？
   - ✅ **是** → 可以生成（跳转到步骤5）
   - ❌ **否** → 继续下一步

4. **二次确认**（必须通过）
   - ❓ 询问用户："准备生成以下文档：[文档路径]，确认要生成吗？"
   - ✅ **用户明确确认** → 继续下一步
   - ❌ **用户未确认或拒绝** → **立即停止**，改为聊天文本响应

5. **生成文档**
   - ✅ 只有通过所有步骤才能到达这里
   - 生成文档到指定目录

**🚨 关键警告**：
- **"分析"、"总结"、"检查"** 等词是**黑名单关键词**，看到这些词必须**禁止生成文档**
- 这些词只能触发**聊天文本响应**，不能生成文档文件
- **任何 STOP 都必须立即停止**，不能继续执行后续步骤
- **不能跳过任何检查**，必须按顺序执行
- **不能"先生成再解释"**，必须在生成前通过所有检查

### 🔄 每次消息独立判断规则

**关键原则**：每个用户消息都必须**独立**评估文档生成资格。同一聊天会话中之前的文档生成**不会**授予后续自动生成的权限。

**规则**：
- ✅ **每条消息**：必须独立通过全部检查
- ❌ **禁止假设**："用户之前想要文档，所以现在也想要"
- ❌ **禁止延续**："我之前生成了文档，所以继续生成"
- ✅ **始终检查**：**这条**特定消息是否包含明确关键词？

**示例**：
```
消息1："生成测试报告" → ✅ 生成文档
消息2："分析一下失败原因" → ❌ 不生成文档，在聊天中提供分析
消息3："总结一下" → ❌ 不生成文档，在聊天中提供总结
消息4："生成总结报告" → ✅ 生成文档（新的明确请求）
```

### ✅ 允许生成文档的情况（白名单）

**只有**用户使用以下明确关键词时才能生成文档：

**直接指令**：
- "生成文档"、"创建文档"、"写一个文档"
- "生成报告"、"创建报告"、"写一个报告"
- "保存为文档"、"保存为文件"、"输出到文件"
- "记录到文档"、"写入文档"

**明确要求**：
- "帮我创建一个...文档"
- "能否生成一份...报告"
- "请写一个...说明文档"

**例外情况**：
- 执行 `review.md` 或 `pre-commit.md` 工作流时（规则已明确，见下文）

**⚠️ 重要**：如果用户没有使用上述关键词，**一律不生成文档**！

### ❌ 禁止自动生成文档的场景（黑名单）

以下场景**严格禁止**自动生成文档，只能在聊天中提供文本响应：

**分析类请求**：
- "分析..."、"分析一下..."、"查看..."、"检查..."、"诊断..."、"排查..."
- ❌ 错误做法：自动生成 `docs/analysis/xxx-analysis.md`
- ✅ 正确做法：在聊天中提供分析结果，询问"需要生成文档吗？"

**总结类请求**：
- "总结..."、"汇总..."、"概括..."、"梳理..."
- ❌ 错误做法：自动生成 `docs/analysis/xxx-summary.md`
- ✅ 正确做法：在聊天中提供总结文本

**完成类请求**：
- "完成..."、"实现..."、"做..."、"处理..."
- ❌ 错误做法：认为"完成"包含"代码+报告"
- ✅ 正确做法："完成"仅指代码实现，在聊天中总结成果

**进度类请求**：
- "进展如何"、"做到哪了"、"状态如何"、"完成了什么"
- ❌ 错误做法：自动生成 `docs/analysis/xxx-progress.md`
- ✅ 正确做法：在聊天中报告进度

**审查类请求**：
- "审查..."、"review..."、"检视..."、"看看..."
- ❌ 错误做法：自动生成 `docs/analysis/xxx-review.md`
- ✅ 正确做法：在聊天中提供审查意见
- ⚠️ 例外：执行 `review.md` 工作流（规则已明确，见下文）

### 🔐 检查工作流报告生成规则

**特殊例外**：执行以下工作流时，**必须**自动生成报告：

- **综合深入检查**（`docs/guidelines/development/workflows/review.md`）：
  - 执行后必须自动生成 `report/review-report-{timestamp}.md`
- **提交前检查**（`docs/guidelines/development/workflows/pre-commit.md`）：
  - 执行后必须自动生成 `report/pre-commit-report-{timestamp}.md`

**时间戳格式**：`YYYY-MM-DD_HH-MM-SS`（如：`2025-12-23_22-55-15`）
**报告内容**：按照工作流文档中的报告模板生成完整检查报告
**报告位置**：所有报告文档必须保存在 `report/` 目录下

### 🔒 规则优先级和执行保证

**优先级顺序**（从高到低）：
1. **遵守规则**（最高优先级）- 规则是绝对约束，不是建议
2. **用户明确请求** - 只有在用户明确要求时才执行操作
3. **完成任务** - 在遵守规则的前提下完成任务

**执行保证**：
- 必须严格按照快速决策树执行，不能跳过任何检查
- 每次生成文档前必须独立判断，不能基于上下文假设
- 如果检测到违规，必须立即纠正（删除文档，承认错误）

## 📁 文档分类与存储

**⚠️ 重要说明**：本节规则**仅适用于已经决定生成文档后的分类**，不能用于判断是否应该生成文档。是否生成文档必须严格按照上方的"文档生成规则"执行。

**核心原则**：**所有生成的文档文件，根据文档类型自动归类到对应目录。**

**分类逻辑**：
- 如果用户明确指定了文档类型或存放位置，使用指定类型/位置
- 如果未指定类型，根据文档内容中的关键词（参考下方文档分类表）进行分类
- 如果无法确定类型，默认存放到 `docs/analysis/`

**🚨 重要**：此处的"分析"等关键词**仅用于分类**，不是生成文档的触发条件！

### 文档分类表

**🚨 关键警告**：此表**仅用于文档分类**（决定已生成的文档存放到哪个目录），**绝对不能**用于判断是否应该生成文档！

| 文档类型 | 目录 | 命名模式 | 关键词（保留中文关键词） |
|---------|------|---------|-------------------------|
| 架构设计文档 | `docs/architecture/` | `{TOPIC}.md` | 架构、架构设计、Architecture、模块架构、系统设计 |
| 开发指南和规范文档 | `docs/guidelines/` | `{TOPIC}.md` | 指南、规范、Guidelines、开发规范、测试规范、文档规范 |
| 版本迁移文档 | `docs/migration/` | `{TOPIC}.md` | 迁移、Migration、版本升级、配置迁移 |
| TODO 文档 | `docs/requirements/` | `{TOPIC}.md` | TODO、待办、待实现、计划 |
| 需求文档 | `docs/requirements/` | `{TOPIC}.md` | 需求、需求分析、功能需求、需求文档 |
| 分析文档 | `docs/analysis/` | `{TOPIC}.md` | 分析、ANALYSIS、问题分析、技术分析、测试分析、代码分析、性能分析、架构分析、设计分析、代码审查分析、问题诊断、分析报告、检查报告（包括所有类型的分析文档） |
| 分析报告文档 | `report/` | `{TOPIC}.md` | 分析报告、检查报告、代码分析、质量报告（from pre-commit.md） |

**⚠️ 强制分类规则**：
- **必须**将文档分类存放到上述对应目录中
- 如果无法归类到任何指定类型，**必须**直接存放到 `docs/analysis/` 目录
- **禁止**在项目根目录或其他位置随意创建文档文件

### 文档存放决策流程

1. **检查用户是否明确指定了文档类型或存放位置**
   - 如果用户明确指定了类型（如"生成分析报告"、"生成需求文档"），根据指定类型归类
   - 如果用户明确指定了目录（如"存放到 `docs/development/`"），使用指定目录

2. **如果未指定类型，根据文档内容关键词分类**：
   - 检查文档标题或内容中的关键词，参考上方的**文档分类表**
   - 包含"架构"、"架构设计"、"Architecture"等 → `docs/architecture/`
   - 包含"指南"、"规范"、"Guidelines"等 → `docs/guidelines/`
   - 包含"迁移"、"Migration"等 → `docs/migration/`
   - 包含"分析"、"ANALYSIS"、"问题分析"、"技术分析"、"测试分析"、"代码分析"、"性能分析"、"架构分析"、"设计分析"、"代码审查分析"、"问题诊断"等 → `docs/analysis/`
   - 包含"分析报告"、"检查报告"、"质量报告"等 → `report/`
   - 包含"TODO"、"待办"、"待实现"、"计划"、"需求"、"需求分析"、"功能需求"、"需求文档"等 → `docs/requirements/`

3. **如果无法确定类型，默认存放到 `docs/analysis/`**

### 文档命名规范

所有文档都使用 `{TOPIC}.md` 格式，主题名称使用 `kebab-case` 格式（例如：`test-coverage.md`、`jira.md`）。

### 创建新文档时的注意事项

- **文档编写指南**：使用模板创建新文档（参考 `docs/guidelines/document.md`）
  - 根据文档类型选择合适的模板（架构文档、指南文档、需求文档、检查工作流文档、开发工作流文档、检查指南文档）
  - 遵循文档编写规范和章节检查清单
- **文档时间戳**：在文档末尾添加"最后更新"时间戳（参考 `docs/guidelines/document.md` 中的"文档时间戳维护"章节）
  - 格式：`**最后更新**: YYYY-MM-DD`
  - 位置：文档末尾，分隔线之后
  - **重要**：每次更新文档内容时，必须同步更新文档末尾的时间戳为当前日期
- **文档规范**：确保文档遵循项目的文档编写规范

## 文档修改规则

**禁止在没有用户明确同意或说明的情况下修改现有文档文件。** 如需修改文档，必须先获得用户同意或用户明确说明需要修改。

## 文档索引规则

- **禁止索引**：`docs/analysis/` 和 `report/` 目录下的文档**绝对不应该**被索引到 `docs/README.md` 或项目根目录 `README.md` 中
- 这些目录包含**临时分析文档**，不是参考文档，不需要在文档索引中展示
- **需求文档索引限制**：`docs/requirements/` 目录下的需求文档**只需要**在 `docs/requirements/README.md` 中索引，**不需要**在 `docs/README.md` 或项目根目录 `README.md` 中索引
- **参考文档**：`docs/` 目录下的其他文档（架构文档、指南文档、迁移文档）是参考文档，应该被索引到 `docs/README.md` 中
- **文档索引更新**：创建新文档时，更新相应的文档索引（如适用）：
  - TODO 文档：只在 `docs/requirements/README.md` 中索引
  - 其他参考文档：在 `docs/README.md` 中索引

## 文档删除规则

- **临时文档（可直接删除）**：
  - `docs/analysis/` 目录下的所有文档都是临时技术分析，可以随时删除
  - `report/` 目录下的所有文档都是临时分析报告，可以随时删除
  - 这些文档用于开发过程中的分析和记录，不需要长期保留
- **参考文档（删除需谨慎）**：
  - `docs/` 目录下的文档是**参考文档和架构文档**，删除需要非常注意
  - 包括：架构文档（`docs/architecture/`）、指南文档（`docs/guidelines/`）、迁移文档（`docs/migration/`）、待办文档（`docs/requirements/`）
  - 这些文档是项目的知识库和参考材料，删除前必须确认不再需要
  - **特别说明**：TODO 文档虽然是参考文档，但只在 `docs/requirements/README.md` 中维护索引，不在主文档索引中展示

---

**最后更新**: 2025-12-28
